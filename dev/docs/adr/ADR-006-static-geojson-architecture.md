# ADR-006: 静的GeoJSONデータアーキテクチャ

- 日付: 2025-01-17
- ステータス: 承認
- レイヤ: infrastructure
- 種別: データストア
- 関連コンポーネント: public/data/stations.json / hooks/useStations.ts / types/index.ts

---

## 1. 背景 / コンテキスト

- 目的・解決したいこと:
  - 東京エリアの駅データを効率的に管理・配信したい
  - フロントエンドのみで完結するアーキテクチャを実現したい

- 前提・制約:
  - 約140駅のデータセット（東京エリア）
  - データ更新頻度は低い（路線・駅の新設は年単位）
  - バックエンドAPIなし

- この ADR がカバーする範囲:
  - データ形式の選定
  - データ配信方式の決定
  - スケーラビリティの制約

---

## 2. 決定

**静的GeoJSONファイル**（`public/data/stations.json`）としてデータを配信し、**フェッチ時にクライアントサイドでパース**する。

データ構造:
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": { "type": "Point", "coordinates": [139.xxx, 35.xxx] },
      "properties": {
        "id": "station_001",
        "name": "渋谷",
        "lines": ["山手線", "埼京線", "銀座線"],
        "operator": "JR東日本"
      }
    }
  ]
}
```

---

## 3. 選択肢と評価

### 採用案（本 ADR の決定）

- 概要:
  - 静的GeoJSONファイルをpublic/配下に配置
  - ビルド時に含まれ、CDN経由で配信
- メリット:
  - サーバーインフラ不要
  - キャッシュ効率が良い（ファイルハッシュでキャッシュバスト）
  - GeoJSON標準で他ツールとの相互運用性
  - オフライン対応（Service Worker併用時）
- デメリット / リスク:
  - 大規模データ（10,000+）には不向き
  - データ更新にはビルド・デプロイが必要

### 代替案 A: REST API（バックエンド）

- 概要: 駅データをAPIサーバーから取得
- 採用しなかった理由:
  - 140駅程度では過剰なインフラ
  - 運用コスト・複雑性が増加
  - ネットワーク遅延

### 代替案 B: JSONではなくTypeScriptファイルに埋め込み

- 概要: `stations.ts` としてエクスポート
- 採用しなかった理由:
  - バンドルサイズが増加（コード分割が効かない）
  - データとコードの分離ができない
  - 外部ツールでの編集が困難

---

## 4. 根拠（評価軸と判断）

- ビジョンとの整合:
  - 「バックエンドなしで完結」という方針に合致
  - 静的サイトホスティング（GitHub Pages等）で運用可能

- 非機能要件:
  - 初期ロード: ~690行のJSON（圧縮後約15KB）
  - キャッシュ: ブラウザキャッシュ + CDNキャッシュ活用

- スケーラビリティ制約:
  | 駅数 | 対応 | 備考 |
  |------|------|------|
  | ~500 | ◎ | 現行アーキテクチャで問題なし |
  | ~2,000 | ○ | 初期ロード時間に注意 |
  | 10,000+ | × | API + サーバーサイド検索が必要 |

---

## 5. 影響範囲

- コード / ディレクトリ構成:
  - `public/data/stations.json` - 駅データ
  - `src/hooks/useStations.ts` - データフェッチ
  - `src/types/index.ts` - Station型定義

- 既存・将来のコンポーネント:
  - useStationsフックがデータローディングを担当
  - 将来のデータ追加（路線情報等）も同じパターン

- 運用プロセス:
  - データ更新: stations.json編集 → コミット → デプロイ
  - バージョン管理: Gitで履歴追跡

---

## 6. ロールアウト / 移行方針

- フェーズ:
  - 初期実装で完了済み

- 具体的ステップ:
  1. 駅データをGeoJSON形式で作成
  2. public/data/配下に配置
  3. useStationsフックでfetch + パース
  4. TypeScript型でデータ構造を保証

- 将来の移行パス:
  - 2,000駅以上: データ分割（エリア別JSON）
  - 10,000駅以上: バックエンドAPI導入

---

## 7. オープンな論点 / フォローアップ

- open question:
  - データ更新の自動化（外部ソースからの定期取得）
  - 圧縮形式（gzip/brotli）の検討

- 別 ADR に切る予定のテーマ:
  - 駅データの取得元・更新フロー

---

## 8. 関連 ADR

- ADR-001: クライアントサイド空間インデックス
- ADR-005: 座標系管理
